# æ¨¡å— 03ï¼šè®¾è®¡ç³»ç»Ÿå½’çº³

[â† è¿”å›ä¸»æ–‡æ¡£](../AI_AGENT_è§†è§‰è¿˜åŸ_SOP_3.1_ä¸»æ–‡æ¡£.md)

---

## ğŸ¯ ç›®æ ‡

ä»æå–çš„CSSä¸­æç‚¼å¯å¤ç”¨çš„è®¾è®¡tokenï¼Œå»ºç«‹ç»Ÿä¸€çš„è®¾è®¡ç³»ç»Ÿã€‚

---

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### 1. å½’çº³é¢œè‰²ç³»ç»Ÿ

**ç›®æ ‡**ï¼šè¯†åˆ«å¹¶åˆ†ç±»æ‰€æœ‰ä½¿ç”¨çš„é¢œè‰²

**æ‰§è¡Œæ–¹æ³•**ï¼š

```python
import re
from collections import Counter

def extract_colors_from_css(css_file):
    """ä»CSSä¸­æå–æ‰€æœ‰é¢œè‰²å€¼"""
    with open(css_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    colors = []
    
    # åŒ¹é…hexé¢œè‰²
    hex_colors = re.findall(r'#[0-9A-Fa-f]{3,6}\b', content)
    colors.extend(hex_colors)
    
    # åŒ¹é…rgb/rgba
    rgb_colors = re.findall(r'rgba?\([^)]+\)', content)
    colors.extend(rgb_colors)
    
    # åŒ¹é…hsl/hsla
    hsl_colors = re.findall(r'hsla?\([^)]+\)', content)
    colors.extend(hsl_colors)
    
    # ç»Ÿè®¡é¢‘ç‡
    color_freq = Counter(colors)
    
    return color_freq

def categorize_colors(color_freq):
    """å°†é¢œè‰²åˆ†ç±»"""
    import colorsys
    
    categories = {
        'primary': [],      # ä¸»è‰²
        'secondary': [],    # è¾…è‰²
        'accent': [],       # å¼ºè°ƒè‰²
        'neutral': [],      # ä¸­æ€§è‰²ï¼ˆç°åº¦ï¼‰
        'semantic': {       # è¯­ä¹‰è‰²
            'success': [],
            'warning': [],
            'error': [],
            'info': []
        }
    }
    
    # ç®€åŒ–ï¼šæ ¹æ®ä½¿ç”¨é¢‘ç‡å’Œé¢œè‰²ç‰¹å¾åˆ†ç±»
    sorted_colors = color_freq.most_common()
    
    for i, (color, count) in enumerate(sorted_colors[:20]):  # åªçœ‹å‰20ä¸ªæœ€å¸¸ç”¨çš„
        # è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„é¢œè‰²åˆ†ç±»é€»è¾‘
        # ç®€åŒ–ç‰ˆæœ¬ï¼šæŒ‰ä½¿ç”¨é¢‘ç‡åˆ†é…
        if i < 3:
            categories['primary'].append({'color': color, 'usage_count': count})
        elif i < 6:
            categories['secondary'].append({'color': color, 'usage_count': count})
        else:
            # åˆ¤æ–­æ˜¯å¦ä¸ºç°åº¦è‰²
            if is_neutral_color(color):
                categories['neutral'].append({'color': color, 'usage_count': count})
    
    return categories

def is_neutral_color(color):
    """åˆ¤æ–­æ˜¯å¦ä¸ºä¸­æ€§è‰²ï¼ˆç°åº¦ï¼‰"""
    # ç®€åŒ–åˆ¤æ–­ï¼šæ£€æŸ¥hexé¢œè‰²çš„RGBå€¼æ˜¯å¦æ¥è¿‘
    if color.startswith('#'):
        hex_color = color.lstrip('#')
        if len(hex_color) == 3:
            r, g, b = [int(c*2, 16) for c in hex_color]
        else:
            r = int(hex_color[0:2], 16)
            g = int(hex_color[2:4], 16)
            b = int(hex_color[4:6], 16)
        
        # å¦‚æœRGBå€¼å·®å¼‚å°äº20ï¼Œè®¤ä¸ºæ˜¯ç°åº¦è‰²
        return max(r,g,b) - min(r,g,b) < 20
    
    return False
```

---

### 2. å½’çº³å­—ä½“ç³»ç»Ÿ

**ç›®æ ‡**ï¼šæå–å­—ä½“å®¶æ—ã€å¤§å°ã€ç²—ç»†ã€è¡Œé«˜

**æ‰§è¡Œæ–¹æ³•**ï¼š

```python
def extract_typography_system(css_file):
    """æå–å­—ä½“ç³»ç»Ÿ"""
    with open(css_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    typography = {
        'font_families': set(),
        'font_sizes': Counter(),
        'font_weights': Counter(),
        'line_heights': Counter(),
        'letter_spacings': Counter()
    }
    
    # æå–font-family
    font_families = re.findall(r'font-family:\s*([^;]+);', content)
    for ff in font_families:
        typography['font_families'].add(ff.strip())
    
    # æå–font-size
    font_sizes = re.findall(r'font-size:\s*([^;]+);', content)
    typography['font_sizes'].update(fs.strip() for fs in font_sizes)
    
    # æå–font-weight
    font_weights = re.findall(r'font-weight:\s*([^;]+);', content)
    typography['font_weights'].update(fw.strip() for fw in font_weights)
    
    # æå–line-height
    line_heights = re.findall(r'line-height:\s*([^;]+);', content)
    typography['line_heights'].update(lh.strip() for lh in line_heights)
    
    # æå–letter-spacing
    letter_spacings = re.findall(r'letter-spacing:\s*([^;]+);', content)
    typography['letter_spacings'].update(ls.strip() for ls in letter_spacings)
    
    return typography

def create_typography_scale(font_sizes):
    """åˆ›å»ºå­—ä½“å¤§å°æ¯”ä¾‹å°º"""
    # æå–æ•°å€¼å¹¶æ’åº
    sizes_px = []
    for size, count in font_sizes.items():
        match = re.match(r'(\d+(?:\.\d+)?)px', size)
        if match:
            sizes_px.append((float(match.group(1)), count))
    
    sizes_px.sort()
    
    # åˆ›å»ºå‘½åæ¯”ä¾‹å°º
    scale = {}
    size_names = ['xs', 'sm', 'base', 'lg', 'xl', '2xl', '3xl', '4xl', '5xl', '6xl']
    
    for i, (size, count) in enumerate(sizes_px[:10]):  # æœ€å¤š10ä¸ªå±‚çº§
        if i < len(size_names):
            scale[size_names[i]] = f"{size}px"
    
    return scale
```

---

### 3. å½’çº³é—´è·ç³»ç»Ÿ

**ç›®æ ‡**ï¼šæå–å¸¸ç”¨çš„paddingã€marginã€gapå€¼

**æ‰§è¡Œæ–¹æ³•**ï¼š

```python
def extract_spacing_system(css_file):
    """æå–é—´è·ç³»ç»Ÿ"""
    with open(css_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    spacing_values = Counter()
    
    # æå–paddingå€¼
    paddings = re.findall(r'padding(?:-[a-z]+)?:\s*([^;]+);', content)
    for p in paddings:
        # åˆ†å‰²å¤šå€¼paddingï¼ˆå¦‚ï¼š10px 20pxï¼‰
        values = p.split()
        spacing_values.update(values)
    
    # æå–marginå€¼
    margins = re.findall(r'margin(?:-[a-z]+)?:\s*([^;]+);', content)
    for m in margins:
        values = m.split()
        spacing_values.update(values)
    
    # æå–gapå€¼
    gaps = re.findall(r'gap:\s*([^;]+);', content)
    spacing_values.update(gaps)
    
    return spacing_values

def create_spacing_scale(spacing_values):
    """åˆ›å»ºé—´è·æ¯”ä¾‹å°º"""
    # åªä¿ç•™pxå•ä½çš„å€¼
    spacing_px = []
    for value, count in spacing_values.items():
        match = re.match(r'(\d+(?:\.\d+)?)px', value)
        if match:
            spacing_px.append((float(match.group(1)), count))
    
    spacing_px.sort()
    
    # åˆ›å»ºä»¥8pxä¸ºåŸºç¡€çš„æ¯”ä¾‹å°º
    base = 8
    scale = {}
    
    for size, count in spacing_px:
        # è½¬æ¢ä¸ºbaseçš„å€æ•°
        multiplier = round(size / base)
        if multiplier > 0:
            scale[f"spacing-{multiplier}"] = f"{size}px"
    
    return scale
```

---

### 4. è¯†åˆ«ç»„ä»¶å˜ä½“

**ç›®æ ‡**ï¼šè¯†åˆ«åŒä¸€ç»„ä»¶çš„ä¸åŒæ ·å¼å˜ä½“ï¼ˆå¦‚ï¼šä¸»æŒ‰é’®ã€æ¬¡æŒ‰é’®ï¼‰

**æ‰§è¡Œæ–¹æ³•**ï¼š

```python
def extract_component_variants(rules):
    """è¯†åˆ«ç»„ä»¶å˜ä½“"""
    components = {}
    
    # æŒ‰ç»„ä»¶ç±»å‹åˆ†ç»„
    component_types = ['btn', 'button', 'card', 'input', 'link', 'badge']
    
    for comp_type in component_types:
        components[comp_type] = []
        
        for rule in rules:
            selector = rule['selector']
            
            # æ£€æŸ¥æ˜¯å¦åŒ¹é…ç»„ä»¶ç±»å‹
            if comp_type in selector.lower():
                # æå–å˜ä½“åç§°
                variant = extract_variant_name(selector, comp_type)
                
                components[comp_type].append({
                    'variant': variant,
                    'selector': selector,
                    'properties': rule['properties']
                })
    
    # ç§»é™¤ç©ºçš„ç»„ä»¶ç±»å‹
    components = {k: v for k, v in components.items() if v}
    
    return components

def extract_variant_name(selector, base_name):
    """ä»é€‰æ‹©å™¨ä¸­æå–å˜ä½“åç§°"""
    # ç¤ºä¾‹ï¼š.btn-primary â†’ primary
    #       .button--large â†’ large
    
    patterns = [
        f'{base_name}-([a-z0-9]+)',   # btn-primary
        f'{base_name}--([a-z0-9]+)',  # button--large
        f'{base_name}_([a-z0-9]+)',   # btn_outline
    ]
    
    for pattern in patterns:
        match = re.search(pattern, selector, re.IGNORECASE)
        if match:
            return match.group(1)
    
    return 'default'
```

---

## ğŸ“¤ è¾“å‡ºæ ¼å¼

### design_tokens.json

```json
{
  "stage": "é˜¶æ®µ3ï¼šè®¾è®¡ç³»ç»Ÿå½’çº³",
  "colors": {
    "primary": {
      "main": "#3B82F6",
      "light": "#60A5FA",
      "dark": "#2563EB"
    },
    "secondary": {
      "main": "#10B981",
      "light": "#34D399",
      "dark": "#059669"
    },
    "neutral": {
      "50": "#F9FAFB",
      "100": "#F3F4F6",
      "200": "#E5E7EB",
      "300": "#D1D5DB",
      "400": "#9CA3AF",
      "500": "#6B7280",
      "600": "#4B5563",
      "700": "#374151",
      "800": "#1F2937",
      "900": "#111827"
    },
    "semantic": {
      "success": "#10B981",
      "warning": "#F59E0B",
      "error": "#EF4444",
      "info": "#3B82F6"
    }
  },
  "typography": {
    "fontFamily": {
      "primary": "'Inter', -apple-system, sans-serif",
      "secondary": "'Poppins', sans-serif",
      "mono": "'Fira Code', monospace"
    },
    "fontSize": {
      "xs": "12px",
      "sm": "14px",
      "base": "16px",
      "lg": "18px",
      "xl": "20px",
      "2xl": "24px",
      "3xl": "30px",
      "4xl": "36px",
      "5xl": "48px"
    },
    "fontWeight": {
      "normal": "400",
      "medium": "500",
      "semibold": "600",
      "bold": "700"
    },
    "lineHeight": {
      "tight": "1.25",
      "normal": "1.5",
      "relaxed": "1.75"
    }
  },
  "spacing": {
    "0": "0px",
    "1": "8px",
    "2": "16px",
    "3": "24px",
    "4": "32px",
    "5": "40px",
    "6": "48px",
    "8": "64px",
    "10": "80px",
    "12": "96px",
    "16": "128px",
    "20": "160px"
  },
  "borderRadius": {
    "none": "0",
    "sm": "4px",
    "base": "8px",
    "md": "12px",
    "lg": "16px",
    "full": "9999px"
  },
  "shadows": {
    "sm": "0 1px 2px 0 rgb(0 0 0 / 0.05)",
    "base": "0 1px 3px 0 rgb(0 0 0 / 0.1)",
    "md": "0 4px 6px -1px rgb(0 0 0 / 0.1)",
    "lg": "0 10px 15px -3px rgb(0 0 0 / 0.1)",
    "xl": "0 20px 25px -5px rgb(0 0 0 / 0.1)"
  },
  "components": {
    "button": {
      "variants": ["primary", "secondary", "outline", "ghost"],
      "sizes": ["sm", "md", "lg"]
    },
    "card": {
      "variants": ["default", "outlined", "elevated"],
      "padding": "spacing-4"
    }
  }
}
```

---

## âœ… æ£€æŸ¥ç‚¹

å®Œæˆæœ¬é˜¶æ®µåï¼Œç¡®è®¤ï¼š

- [ ] é¢œè‰²ç³»ç»Ÿå·²å½’çº³
  - [ ] ä¸»è‰²ã€è¾…è‰²å·²è¯†åˆ«
  - [ ] ä¸­æ€§è‰²ï¼ˆç°åº¦ï¼‰å·²æå–
  - [ ] è¯­ä¹‰è‰²å·²è¯†åˆ«
- [ ] å­—ä½“ç³»ç»Ÿå·²å½’çº³
  - [ ] å­—ä½“å®¶æ—å·²æå–
  - [ ] å­—ä½“å¤§å°æ¯”ä¾‹å°ºå·²åˆ›å»º
  - [ ] å­—é‡ã€è¡Œé«˜å·²æ•´ç†
- [ ] é—´è·ç³»ç»Ÿå·²å½’çº³
  - [ ] å¸¸ç”¨é—´è·å€¼å·²æå–
  - [ ] é—´è·æ¯”ä¾‹å°ºå·²åˆ›å»º
- [ ] ç»„ä»¶å˜ä½“å·²è¯†åˆ«
- [ ] design_tokens.jsonå·²ç”Ÿæˆ

---

## ğŸ’¡ ä½¿ç”¨è®¾è®¡Token

ç”Ÿæˆçš„design tokenså¯ä»¥ç›´æ¥ç”¨äºReacté¡¹ç›®ï¼š

### æ–¹æ³•1ï¼šä½œä¸ºCSSå˜é‡

```css
:root {
  /* Colors */
  --color-primary: #3B82F6;
  --color-secondary: #10B981;
  
  /* Typography */
  --font-size-base: 16px;
  --font-weight-normal: 400;
  
  /* Spacing */
  --spacing-1: 8px;
  --spacing-2: 16px;
}
```

### æ–¹æ³•2ï¼šä½œä¸ºTypeScriptå¸¸é‡

```typescript
// design-tokens.ts
export const colors = {
  primary: '#3B82F6',
  secondary: '#10B981',
  // ...
};

export const spacing = {
  1: '8px',
  2: '16px',
  // ...
};
```

### æ–¹æ³•3ï¼šTailwindé…ç½®

```javascript
// tailwind.config.js
module.exports = {
  theme: {
    colors: {
      primary: '#3B82F6',
      secondary: '#10B981',
      // ...
    },
    spacing: {
      1: '8px',
      2: '16px',
      // ...
    }
  }
}
```

---

[â† ä¸Šä¸€æ­¥ï¼šæ¨¡å—02 - æ ·å¼æå–](./02_æ ·å¼æå–.md) | [â†’ ä¸‹ä¸€æ­¥ï¼šæ¨¡å—04 - åˆ†æ®µå†…å®¹æå–](./04_åˆ†æ®µå†…å®¹æå–.md)
