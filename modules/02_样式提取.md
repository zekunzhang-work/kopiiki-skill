# æ¨¡å— 02ï¼šæ ·å¼æå–

[â† è¿”å›ä¸»æ–‡æ¡£](../AI_AGENT_è§†è§‰è¿˜åŸ_SOP_3.1_ä¸»æ–‡æ¡£.md)

---

## ğŸ¯ ç›®æ ‡

å®Œæ•´æå–CSSè®¾è®¡ç³»ç»Ÿï¼Œ**æ’é™¤åŠ¨ç”»ç›¸å…³æ ·å¼**ï¼Œä¸ºReacté¡¹ç›®å‡†å¤‡é™æ€æ ·å¼è¡¨ã€‚

---

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

### 1. æå–CSSå˜é‡

**ç›®æ ‡**ï¼šæå–`:root`ä¸­å®šä¹‰çš„æ‰€æœ‰CSSå˜é‡

**æ‰§è¡Œæ–¹æ³•**ï¼š

```python
import re

def extract_css_variables(css_file):
    """æå–CSSå˜é‡"""
    with open(css_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # æ‰¾åˆ°:rootå—
    root_match = re.search(r':root\s*\{([^}]*)\}', content, re.DOTALL)
    
    if not root_match:
        return {}
    
    root_content = root_match.group(1)
    
    # æå–æ‰€æœ‰å˜é‡
    variables = {}
    var_pattern = r'--([a-zA-Z0-9-]+)\s*:\s*([^;]+);'
    
    for match in re.finditer(var_pattern, root_content):
        var_name = f"--{match.group(1)}"
        var_value = match.group(2).strip()
        variables[var_name] = var_value
    
    return variables

# æ‰§è¡Œ
variables = extract_css_variables('webflow.css')
print(f"æ‰¾åˆ° {len(variables)} ä¸ªCSSå˜é‡")

# æŒ‰ç±»å‹åˆ†ç±»
colors = {k: v for k, v in variables.items() if 'color' in k or k.startswith('--primary') or k.startswith('--secondary')}
fonts = {k: v for k, v in variables.items() if 'font' in k or 'text' in k}
spacing = {k: v for k, v in variables.items() if 'space' in k or 'gap' in k or 'padding' in k or 'margin' in k}
```

---

### 2. æå–æ ·å¼é€‰æ‹©å™¨ï¼ˆæ’é™¤åŠ¨ç”»ï¼‰

**ç›®æ ‡**ï¼šæå–æ‰€æœ‰CSSé€‰æ‹©å™¨åŠå…¶æ ·å¼ï¼Œ**æ’é™¤**åŠ¨ç”»ç›¸å…³å±æ€§

**éœ€è¦æ’é™¤çš„å±æ€§**ï¼š
- `animation`
- `animation-*`ï¼ˆæ‰€æœ‰animationç›¸å…³å±æ€§ï¼‰
- `transition`
- `transition-*`
- `@keyframes`ï¼ˆæ•´ä¸ªkeyframeså—ï¼‰
- åŠ¨æ€`transform`ï¼ˆä¿ç•™é™æ€transformï¼‰

**æ‰§è¡Œæ–¹æ³•**ï¼š

```python
def extract_css_rules(css_file):
    """æå–CSSè§„åˆ™ï¼Œæ’é™¤åŠ¨ç”»"""
    with open(css_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # ç§»é™¤@keyframeså—
    content = re.sub(r'@keyframes[^{]*\{(?:[^{}]*|\{[^{}]*\})*\}', '', content, flags=re.DOTALL)
    
    # ç§»é™¤@-webkit-keyframeså—
    content = re.sub(r'@-webkit-keyframes[^{]*\{(?:[^{}]*|\{[^{}]*\})*\}', '', content, flags=re.DOTALL)
    
    # æå–æ‰€æœ‰CSSè§„åˆ™
    rules = []
    
    # åŒ¹é…é€‰æ‹©å™¨å’Œæ ·å¼å—
    pattern = r'([^{}]+)\s*\{([^{}]+)\}'
    
    for match in re.finditer(pattern, content):
        selector = match.group(1).strip()
        properties = match.group(2).strip()
        
        # è·³è¿‡@media, @importç­‰at-rulesï¼ˆç¨åå•ç‹¬å¤„ç†ï¼‰
        if selector.startswith('@') and not selector.startswith('@media'):
            continue
        
        # è¿‡æ»¤åŠ¨ç”»ç›¸å…³å±æ€§
        filtered_properties = filter_animation_properties(properties)
        
        if filtered_properties:
            rules.append({
                'selector': selector,
                'properties': filtered_properties
            })
    
    return rules

def filter_animation_properties(properties):
    """è¿‡æ»¤æ‰åŠ¨ç”»ç›¸å…³å±æ€§"""
    lines = properties.split(';')
    filtered_lines = []
    
    excluded_keywords = [
        'animation',
        'transition',
        '@keyframes'
    ]
    
    for line in lines:
        line = line.strip()
        if not line:
            continue
        
        # æ£€æŸ¥æ˜¯å¦åŒ…å«æ’é™¤çš„å…³é”®è¯
        should_exclude = False
        for keyword in excluded_keywords:
            if line.startswith(keyword):
                should_exclude = True
                break
        
        if not should_exclude:
            filtered_lines.append(line)
    
    return '; '.join(filtered_lines)
```

---

### 3. æå–å“åº”å¼æ–­ç‚¹

**ç›®æ ‡**ï¼šè¯†åˆ«æ‰€æœ‰`@media`æŸ¥è¯¢åŠå…¶æ–­ç‚¹

**æ‰§è¡Œæ–¹æ³•**ï¼š

```python
def extract_media_queries(css_file):
    """æå–æ‰€æœ‰åª’ä½“æŸ¥è¯¢"""
    with open(css_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    media_queries = {}
    
    # åŒ¹é…@mediaå—
    pattern = r'@media\s*([^{]+)\s*\{([^{}]*(?:\{[^{}]*\}[^{}]*)*)\}'
    
    for match in re.finditer(pattern, content, re.DOTALL):
        query = match.group(1).strip()
        rules = match.group(2).strip()
        
        # æå–æ–­ç‚¹å€¼
        breakpoint = extract_breakpoint_value(query)
        
        if breakpoint:
            if breakpoint not in media_queries:
                media_queries[breakpoint] = []
            
            # æå–è¯¥åª’ä½“æŸ¥è¯¢å†…çš„è§„åˆ™
            rules_list = extract_css_rules_from_string(rules)
            media_queries[breakpoint].extend(rules_list)
    
    return media_queries

def extract_breakpoint_value(query):
    """ä»åª’ä½“æŸ¥è¯¢ä¸­æå–æ–­ç‚¹å€¼"""
    # åŒ¹é…max-widthæˆ–min-width
    max_width = re.search(r'max-width:\s*(\d+)px', query)
    min_width = re.search(r'min-width:\s*(\d+)px', query)
    
    if max_width:
        return f"max-{max_width.group(1)}px"
    elif min_width:
        return f"min-{min_width.group(1)}px"
    else:
        return query  # è¿”å›å®Œæ•´æŸ¥è¯¢æ¡ä»¶
```

**å¸¸è§Webflowæ–­ç‚¹**ï¼š
```
@media (max-width: 991px)  â†’ å¹³æ¿
@media (max-width: 767px)  â†’ ç§»åŠ¨ç«¯
@media (max-width: 479px)  â†’ å°å±ç§»åŠ¨ç«¯
```

---

### 4. åˆ†ç±»æ ·å¼

**ç›®æ ‡**ï¼šå°†æ ·å¼åˆ†ä¸ºä¸åŒç±»åˆ«ï¼Œä¾¿äºç®¡ç†

**åˆ†ç±»è§„åˆ™**ï¼š

```python
def categorize_styles(rules):
    """å°†æ ·å¼è§„åˆ™åˆ†ç±»"""
    categories = {
        'layout': [],      # å¸ƒå±€ç›¸å…³
        'typography': [],  # æ–‡å­—ç›¸å…³
        'colors': [],      # é¢œè‰²ç›¸å…³
        'spacing': [],     # é—´è·ç›¸å…³
        'components': [],  # ç»„ä»¶ç›¸å…³
        'utilities': []    # å·¥å…·ç±»
    }
    
    for rule in rules:
        selector = rule['selector'].lower()
        properties = rule['properties'].lower()
        
        # å¸ƒå±€ç±»
        if any(kw in properties for kw in ['display', 'flex', 'grid', 'position', 'float']):
            categories['layout'].append(rule)
        
        # æ–‡å­—ç±»
        elif any(kw in properties for kw in ['font', 'text', 'line-height', 'letter-spacing']):
            categories['typography'].append(rule)
        
        # é¢œè‰²ç±»
        elif any(kw in properties for kw in ['color', 'background', 'border-color']):
            categories['colors'].append(rule)
        
        # é—´è·ç±»
        elif any(kw in properties for kw in ['padding', 'margin', 'gap']):
            categories['spacing'].append(rule)
        
        # ç»„ä»¶ç±»ï¼ˆåŸºäºé€‰æ‹©å™¨ï¼‰
        elif any(kw in selector for kw in ['btn', 'button', 'card', 'nav', 'modal', 'form']):
            categories['components'].append(rule)
        
        # å·¥å…·ç±»
        elif selector.startswith('.') and len(selector.split()) == 1:
            categories['utilities'].append(rule)
    
    return categories
```

---

## ğŸ“¤ è¾“å‡ºæ ¼å¼

### css_extraction.json

```json
{
  "stage": "é˜¶æ®µ2ï¼šæ ·å¼æå–",
  "variables": {
    "--primary-color": "#3B82F6",
    "--secondary-color": "#10B981",
    "--text-color": "#1F2937",
    "--bg-light": "#F9FAFB",
    "--font-primary": "'Inter', sans-serif",
    "--font-size-base": "16px",
    "--spacing-unit": "8px"
  },
  "breakpoints": {
    "desktop": "991px",
    "tablet": "767px",
    "mobile": "479px"
  },
  "total_selectors": 523,
  "selectors_by_category": {
    "layout": 145,
    "typography": 89,
    "colors": 76,
    "spacing": 102,
    "components": 85,
    "utilities": 26
  },
  "animation_removed": {
    "keyframes_count": 12,
    "transition_properties": 45,
    "animation_properties": 28
  }
}
```

---

### ç”Ÿæˆæ¸…ç†åçš„CSSæ–‡ä»¶

```python
def generate_clean_css(rules, variables, output_file):
    """ç”Ÿæˆæ¸…ç†åçš„CSSæ–‡ä»¶ï¼ˆæ— åŠ¨ç”»ï¼‰"""
    
    with open(output_file, 'w', encoding='utf-8') as f:
        # å†™å…¥CSSå˜é‡
        f.write(":root {\n")
        for var_name, var_value in variables.items():
            f.write(f"  {var_name}: {var_value};\n")
        f.write("}\n\n")
        
        # å†™å…¥æ ·å¼è§„åˆ™
        for rule in rules:
            f.write(f"{rule['selector']} {{\n")
            
            # æ ¼å¼åŒ–å±æ€§
            properties = rule['properties'].split(';')
            for prop in properties:
                prop = prop.strip()
                if prop:
                    f.write(f"  {prop};\n")
            
            f.write("}\n\n")
    
    print(f"å·²ç”Ÿæˆæ¸…ç†åçš„CSSæ–‡ä»¶: {output_file}")

# æ‰§è¡Œ
generate_clean_css(rules, variables, 'webflow-clean.css')
```

---

## âœ… æ£€æŸ¥ç‚¹

å®Œæˆæœ¬é˜¶æ®µåï¼Œç¡®è®¤ï¼š

- [ ] CSSå˜é‡å·²æå–ï¼ˆ`:root`ï¼‰
- [ ] æ‰€æœ‰é€‰æ‹©å™¨å·²æå–
- [ ] åŠ¨ç”»ç›¸å…³æ ·å¼å·²ç§»é™¤
  - [ ] `@keyframes`å·²ç§»é™¤
  - [ ] `animation`å±æ€§å·²ç§»é™¤
  - [ ] `transition`å±æ€§å·²ç§»é™¤
- [ ] å“åº”å¼æ–­ç‚¹å·²è¯†åˆ«
- [ ] æ ·å¼å·²åˆ†ç±»
- [ ] css_extraction.jsonå·²ç”Ÿæˆ
- [ ] webflow-clean.csså·²ç”Ÿæˆ

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¿ç•™é™æ€transform

```css
/* âœ… ä¿ç•™ - é™æ€3Dæ•ˆæœ */
.card {
  transform: perspective(1000px) rotateY(10deg);
}

/* âŒ ç§»é™¤ - åŠ¨æ€transform */
.card {
  transform: scale(1);
  transition: transform 0.3s ease;
}
.card:hover {
  transform: scale(1.1);
}
```

### å¤„ç†CSSå˜é‡å¼•ç”¨

```css
/* ç¡®ä¿å˜é‡å¼•ç”¨è¢«æ­£ç¡®ä¿ç•™ */
.button {
  background-color: var(--primary-color);
  padding: var(--spacing-unit);
}
```

### å¤„ç†vendorå‰ç¼€

```css
/* ä¿ç•™vendorå‰ç¼€ */
.flex-box {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
```

---

[â† ä¸Šä¸€æ­¥ï¼šæ¨¡å—01 - ç»“æ„åˆ†æ](./01_ç»“æ„åˆ†æ.md) | [â†’ ä¸‹ä¸€æ­¥ï¼šæ¨¡å—03 - è®¾è®¡ç³»ç»Ÿå½’çº³](./03_è®¾è®¡ç³»ç»Ÿå½’çº³.md)
